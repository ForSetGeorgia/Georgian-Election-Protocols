<div id="landing_page">
  <% if @elections.present? %>


    <h2>
      <%= @current_election.name %>
      |
      <%= l @current_election.election_at %>
      <% if @current_election.can_enter_data? %>
        | <i class="icon-edit" title='<%= t('.flags.active') %>'></i>
      <% elsif @current_election.election_at >= (Time.now-1.day).to_date %>
        | <i class="icon-time" title='<%= t('.flags.coming_up') %>'></i>
      <% end %>

      <div class="switch-to dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          <%= t('.choose') %>
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <% @elections.each do |election| %>

            <li>
              <%= link_to params.merge(election: election.analysis_table_name) do %>
                <% flag = election.can_enter_data? ?
                            "#{t('.flags.active')}" : election.election_at >= (Time.now-1.day).to_date ?
                            "#{t('.flags.coming_up')}" : '' %>
                <%= "#{election.name} | #{l election.election_at} | #{flag}" %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
    </h2>

    <div class="tabs">
      <ul class="nav nav-tabs">
        <% if @current_election.can_enter_data? %>
          <li class="active"><a href="#status" data-toggle="tab"><%= t('.tabs.status') %></a></li>
        <% end %>
        <li class="<%= @current_election.can_enter_data? ? '' : 'active' %>"><a href="#summary" data-toggle="tab"><%= t('.tabs.summary') %></a></li>
        <li><a href="#amendments" data-toggle="tab"><%= t('.tabs.amendments') %></a></li>
        <li><a href="#annulled" data-toggle="tab"><%= t('.tabs.annulled') %></a></li>
        <li><a href="#download" data-toggle="tab"><%= t('.tabs.download') %></a></li>
        <% if !@current_election.can_enter_data? %>
          <li><a href="#status" data-toggle="tab"><%= t('.tabs.status') %></a></li>
        <% end %>
      </ul>
      <div class="tab-content tab-content">
        <div class="tab-pane fade in <%= @current_election.can_enter_data? ? 'active' : '' %>" id="status">
          <div class="row-fluid">
            <div class="span6">
              <h3 class="underline"><%= t('.status.headers.data_entry') %></h3>
              <% stats = @overall_stats.select{|x| x[:election_id] == @current_election.id}.first %>
              <% if stats.present? %>
                <div class="row-fluid">
                  <div class="span6">
                    <p>
                      <strong><%= t('.status.overall_stats.districts')%>:</strong>
                      <%= stats[:districts] %>
                    </p>
                    <p>
                      <strong><%= t('.status.overall_stats.precincts')%>:</strong>
                      <%= stats[:precincts] %>
                    </p>
                    <p>
                      <strong><%= t('.status.overall_stats.protocols_found')%>:</strong>
                      <%= stats[:protocols_found][:number] %>
                      (<%= stats[:protocols_found][:percent] %>)
                    </p>
                  </div>
                  <div class="span6">
                    <p class="highlight-bad">
                      <strong><%= t('.status.overall_stats.protocols_missing')%>:</strong>
                      <%= stats[:protocols_missing][:number] %>
                      (<%= stats[:protocols_missing][:percent] %>)
                    </p>
                    <p class="highlight-good">
                      <strong><%= t('.status.overall_stats.protocols_validated')%>:</strong>
                      <%= stats[:protocols_validated][:number] %>
                      <% if stats[:protocols_validated][:number] != I18n.t('app.common.na') %>
                        (<%= stats[:protocols_validated][:percent] %>)
                      <% end %>
                    </p>
                    <p>
                      <strong><%= t('.status.overall_stats.protocols_not_entered')%>:</strong>
                      <%= stats[:protocols_not_entered][:number] %>
                      <% if stats[:protocols_not_entered][:number] != I18n.t('app.common.na') %>
                        (<%= stats[:protocols_not_entered][:percent] %>)
                      <% end %>
                    </p>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="span6">
              <h3 class="underline"><%= t('.status.headers.users') %></h3>
              <div class="row-fluid">
                <div class="span6">
                  <p>
                    <strong><%= t('.status.overall_user_stats.users')%>:</strong>
                    <%= @overall_user_stats[:users] %>
                  </p>
                  <p>
                    <strong><%= t('.status.overall_user_stats.submitted')%>:</strong>
                    <%= @overall_user_stats[:submitted] %>
                  </p>
                  <p>
                    <strong><%= t('.status.overall_user_stats.pending')%>:</strong>
                    <%= @overall_user_stats[:pending][:number] %>
                    <% if @overall_user_stats[:pending][:number] != I18n.t('app.common.na') %>
                      (<%= @overall_user_stats[:pending][:percent] %>)
                    <% end %>
                  </p>
                </div>
                <div class="span6">
                  <p class="highlight-good">
                    <strong><%= t('.status.overall_user_stats.valid')%>:</strong>
                    <%= @overall_user_stats[:valid][:number] %>
                    <% if @overall_user_stats[:valid][:number] != I18n.t('app.common.na') %>
                      (<%= @overall_user_stats[:valid][:percent] %>)
                    <% end %>
                  </p>
                  <p class="highlight-bad">
                    <strong><%= t('.status.overall_user_stats.invalid')%>:</strong>
                    <%= @overall_user_stats[:invalid][:number] %>
                    <% if @overall_user_stats[:invalid][:number] != I18n.t('app.common.na') %>
                      (<%= @overall_user_stats[:invalid][:percent] %>)
                    <% end %>
                  </p>
                  <p>
                    <strong><%= t('.status.overall_user_stats.extra')%>:</strong>
                    <%= @overall_user_stats[:extra][:number] %>
                    <% if @overall_user_stats[:extra][:number] != I18n.t('app.common.na') %>
                      (<%= @overall_user_stats[:extra][:percent] %>)
                    <% end %>
                  </p>
                </div>
              </div>
            </div>
          </div>


          <h3><%= t('.status.headers.districts') %></h3>
          <% stats = @overall_stats_by_district.select{|x| x[:election_id] == @current_election.id}.first %>
          <% if stats.present? %>
            <table class="table table-striped overall_stats_by_district">
              <thead>
                <tr>
                  <% if @current_election.has_regions? %>
                    <th class="hl1">
                      <%= t('.status.overall_stats_by_district.region') %>
                    </th>
                  <% end %>
                  <% if @current_election.has_district_names? %>
                    <th class="hl1">
                      <%= t('.status.overall_stats_by_district.district') %>
                    </th>
                  <% end %>
                  <th class="hl1">
                    <%= t('.status.overall_stats_by_district.district_id') %>
                  </th>
                  <th class="hl1">
                    <%= t('.status.overall_stats_by_district.precincts') %> (#)
                  </th>
                  <th>
                    <%= t('.status.overall_stats_by_district.protocols_missing') %> (#)
                  </th>
                  <th>
                    <%= t('.status.overall_stats_by_district.protocols_found') %> (#)
                  </th>
                  <th>
                    <%= t('.status.overall_stats_by_district.protocols_not_entered') %> (#)
                  </th>
                  <th class="hl2">
                    <%= t('.status.overall_stats_by_district.protocols_validated') %> (#)
                  </th>
                  <th>
                    <%= t('.status.overall_stats_by_district.protocols_missing') %> (%)
                  </th>
                  <th>
                    <%= t('.status.overall_stats_by_district.protocols_found') %> (%)
                  </th>
                  <th>
                    <%= t('.status.overall_stats_by_district.protocols_not_entered') %> (%)
                  </th>
                  <th class="hl2">
                    <%= t('.status.overall_stats_by_district.protocols_validated') %> (%)
                  </th>
                </tr>
              </thead>
              <tbody>
                <% stats[:districts].each do |district| %>
                  <tr>
                    <% if @current_election.has_regions? %>
                      <td>
                        <%= district[:region] %>
                      </td>
                    <% end %>
                    <% if @current_election.has_district_names? %>
                      <td>
                        <%= district[:district] %>
                      </td>
                    <% end %>
                    <td>
                      <%= district[:district_id] %>
                    </td>
                    <td>
                      <%= district[:precincts] %>
                    </td>
                    <td>
                      <%= district[:protocols_missing][:number] %>
                    </td>
                    <td>
                      <%= district[:protocols_found][:number] %>
                    </td>
                    <td>
                      <%= district[:protocols_not_entered][:number] %>
                    </td>
                    <td>
                      <%= district[:protocols_validated][:number] %>
                    </td>
                    <td>
                      <%= district[:protocols_missing][:percent] %>
                    </td>
                    <td>
                      <%= district[:protocols_found][:percent] %>
                    </td>
                    <td>
                      <%= district[:protocols_not_entered][:percent] %>
                    </td>
                    <td>
                      <%= district[:protocols_validated][:percent] %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% end %>
        </div>


        <div class="tab-pane fade in <%= @current_election.can_enter_data? ? '' : 'active' %>" id="summary">

        </div>


        <div class="tab-pane fade in" id="amendments">

        </div>


        <div class="tab-pane fade in" id="annulled">

        </div>

        <div class="tab-pane fade in" id="download">
          <div class="row-fluid">
            <div class="span6">
              <h3 class="underline"><%= t('.status.headers.data_entry') %></h3>
              <% stats = @overall_stats.select{|x| x[:election_id] == @current_election.id}.first %>
              <% if stats.present? %>
                <div class="row-fluid">
                  <div class="span6">
                    <p>
                      <strong><%= t('.status.overall_stats.districts')%>:</strong>
                      <%= stats[:districts] %>
                    </p>
                    <p>
                      <strong><%= t('.status.overall_stats.precincts')%>:</strong>
                      <%= stats[:precincts] %>
                    </p>
                    <p>
                      <strong><%= t('.status.overall_stats.protocols_found')%>:</strong>
                      <%= stats[:protocols_found][:number] %>
                      (<%= stats[:protocols_found][:percent] %>)
                    </p>
                  </div>
                  <div class="span6">
                    <p class="highlight-bad">
                      <strong><%= t('.status.overall_stats.protocols_missing')%>:</strong>
                      <%= stats[:protocols_missing][:number] %>
                      (<%= stats[:protocols_missing][:percent] %>)
                    </p>
                    <p class="highlight-good">
                      <strong><%= t('.status.overall_stats.protocols_validated')%>:</strong>
                      <%= stats[:protocols_validated][:number] %>
                      <% if stats[:protocols_validated][:number] != I18n.t('app.common.na') %>
                        (<%= stats[:protocols_validated][:percent] %>)
                      <% end %>
                    </p>
                    <p>
                      <strong><%= t('.status.overall_stats.protocols_not_entered')%>:</strong>
                      <%= stats[:protocols_not_entered][:number] %>
                      <% if stats[:protocols_not_entered][:number] != I18n.t('app.common.na') %>
                        (<%= stats[:protocols_not_entered][:percent] %>)
                      <% end %>
                    </p>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="span6">
              <h3 class="underline"><%= t('.download.headers.download') %></h3>
              <ul class="data-downloads">
                <li>
                  <%= link_to 'CSV', generate_spreadsheet_path(id: @current_election.analysis_table_name, :format => :csv), class: 'btn btn-success' %>

                </li>
                <li>
                  <%= link_to 'XLS', generate_spreadsheet_path(id: @current_election.analysis_table_name, :format => :xls), class: 'btn btn-success' %>
                </li>
            </div>
          </div>
        </div>


      </div>
    </div>



      <% if @overall_stats_by_district.present? %>
            <% @elections.each_with_index do |election, index| %>
              <% active = index == 0 ? 'active' : '' %>
              <div class="tab-pane fade in <%= active %>" id="district_stats_<%= election.analysis_table_name %>">
                <% stats = @overall_stats_by_district.select{|x| x[:election_id] == election.id}.first %>

              </div>
            <% end %>
          </div>
        </div>
      <% end %>

  <% elsif @elections_coming_up.present? %>

    <div class="row-fluid elections-coming-up">
      <div class="span6">
        <%= link_to(image_tag('share_2016.png'), @bitly_url, target: :blank) %>
      </div>
      <div class="span6">
        <h2><%= t('.stay_tuned.header') %></h2>

        <p><%= t('.stay_tuned.text') %></p>
        <ul class="">
          <% @elections_coming_up.each do |election| %>
            <li><%= "#{election.name} (#{l election.election_at})" %></li>
          <% end %>
        </ul>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span6">
        <h3><%= t('.want_help.header') %></h3>
        <%= simple_format(t('.want_help.text')) %>
      </div>
    </div>
  <% else %>

    <h2><%= t('.no_elections.header') %></h2>
    <%= simple_format(t('.no_elections.text')) %>

  <% end %>

</div>

